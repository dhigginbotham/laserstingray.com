!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){var n,o,r=this.length>>>0,i=!1;for(1<arguments.length&&(o=t,i=!0),n=0;r>n;++n)this.hasOwnProperty(n)&&(i?o=e(o,this[n],n,this):(o=this[n],i=!0));if(!i)throw new TypeError("Reduce of empty array with no initial value");return o}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=[],r=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)if(i in t){var a=t[i];e.call(r,a,i,t)&&o.push(a)}return o});var t,n="function"==typeof define&&define.amd,o=function(t){var n="Comic Sans MS"===t?"Courier New":"Comic Sans MS",o=e("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),r=o.css("fontFamily",n).width(),i=o.css("fontFamily",t+","+n).width();return o.remove(),r!==i},r={isMac:navigator.appVersion.indexOf("Mac")>-1,isMSIE:navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1,isFF:navigator.userAgent.indexOf("Firefox")>-1,jqueryVersion:parseFloat(e.fn.jquery),isSupportAmd:n,hasCodeMirror:n?require.specified("CodeMirror"):!!window.CodeMirror,isFontInstalled:o,isW3CRangeSupport:!!document.createRange},i=function(){var t=function(e){return function(t){return e===t}},n=function(e,t){return e===t},o=function(e){return function(t,n){return t[e]===n[e]}},r=function(){return!0},i=function(){return!1},a=function(e){return function(){return!e.apply(e,arguments)}},s=function(e,t){return function(n){return e(n)&&t(n)}},l=function(e){return e},d=0,c=function(e){var t=++d+"";return e?e+t:t},u=function(t){var n=e(document);return{top:t.top+n.scrollTop(),left:t.left+n.scrollLeft(),width:t.right-t.left,height:t.bottom-t.top}},f=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t};return{eq:t,eq2:n,peq2:o,ok:r,fail:i,self:l,not:a,and:s,uniqueId:c,rect2bnd:u,invertObject:f}}(),a=function(){var e=function(e){return e[0]},t=function(e){return e[e.length-1]},n=function(e){return e.slice(0,e.length-1)},o=function(e){return e.slice(1)},r=function(e,t){for(var n=0,o=e.length;o>n;n++){var r=e[n];if(t(r))return r}},a=function(e,t){for(var n=0,o=e.length;o>n;n++)if(!t(e[n]))return!1;return!0},s=function(e,t){return-1!==e.indexOf(t)},l=function(e,t){return t=t||i.self,e.reduce(function(e,n){return e+t(n)},0)},d=function(e){for(var t=[],n=-1,o=e.length;++n<o;)t[n]=e[n];return t},c=function(n,r){if(!n.length)return[];var i=o(n);return i.reduce(function(e,n){var o=t(e);return r(t(o),n)?o[o.length]=n:e[e.length]=[n],e},[[e(n)]])},u=function(e){for(var t=[],n=0,o=e.length;o>n;n++)e[n]&&t.push(e[n]);return t},f=function(e){for(var t=[],n=0,o=e.length;o>n;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t};return{head:e,last:t,initial:n,tail:o,find:r,contains:s,all:a,sum:l,from:d,clusterBy:c,compact:u,unique:f}}(),s=String.fromCharCode(160),l="",d=function(){var t=function(t){return t&&e(t).hasClass("note-editable")},n=function(t){return t&&e(t).hasClass("note-control-sizing")},o=function(t){var n;if(t.hasClass("note-air-editor")){var o=a.last(t.attr("id").split("-"));return n=function(t){return function(){return e(t+o)}},{editor:function(){return t},editable:function(){return t},popover:n("#note-popover-"),handle:n("#note-handle-"),dialog:n("#note-dialog-")}}return n=function(e){return function(){return t.find(e)}},{editor:function(){return t},dropzone:n(".note-dropzone"),toolbar:n(".note-toolbar"),editable:n(".note-editable"),codable:n(".note-codable"),statusbar:n(".note-statusbar"),popover:n(".note-popover"),handle:n(".note-handle"),dialog:n(".note-dialog")}},c=function(e){return e=e.toUpperCase(),function(t){return t&&t.nodeName.toUpperCase()===e}},u=function(e){return e&&3===e.nodeType},f=function(e){return e&&/^BR|^IMG|^HR/.test(e.nodeName.toUpperCase())},h=function(e){return t(e)?!1:e&&/^DIV|^P|^LI|^H[1-7]/.test(e.nodeName.toUpperCase())},p=c("LI"),v=function(e){return h(e)&&!p(e)},g=function(e){return!C(e)&&!m(e)&&!h(e)},m=function(e){return e&&/^UL|^OL/.test(e.nodeName.toUpperCase())},b=function(e){return e&&/^TD|^TH/.test(e.nodeName.toUpperCase())},y=c("BLOCKQUOTE"),C=function(e){return b(e)||y(e)||t(e)},w=c("A"),k=function(e){return g(e)&&!!E(e,h)},T=function(e){return g(e)&&!E(e,h)},x=c("BODY"),N=r.isMSIE?"&nbsp;":"<br>",L=function(e){return u(e)?e.nodeValue.length:e.childNodes.length},S=function(e){var t=L(e);return 0===t?!0:d.isText(e)||1!==t||e.innerHTML!==N?!1:!0},F=function(e){f(e)||L(e)||(e.innerHTML=N)},E=function(e,n){for(;e;){if(n(e))return e;if(t(e))break;e=e.parentNode}return null},M=function(e,n){n=n||i.fail;var o=[];return E(e,function(e){return t(e)||o.push(e),n(e)}),o},R=function(e,t){var n=M(e);return a.last(n.filter(t))},A=function(t,n){for(var o=M(t),r=n;r;r=r.parentNode)if(e.inArray(r,o)>-1)return r;return null},I=function(e,t){t=t||i.fail;for(var n=[];e&&!t(e);)n.push(e),e=e.previousSibling;return n},D=function(e,t){t=t||i.fail;for(var n=[];e&&!t(e);)n.push(e),e=e.nextSibling;return n},P=function(e,t){var n=[];return t=t||i.ok,function o(r){e!==r&&t(r)&&n.push(r);for(var i=0,a=r.childNodes.length;a>i;i++)o(r.childNodes[i])}(e),n},H=function(t,n){var o=t.parentNode,r=e("<"+n+">")[0];return o.insertBefore(r,t),r.appendChild(t),r},U=function(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e},B=function(t,n){return e.each(n,function(e,n){t.appendChild(n)}),t},z=function(e){return 0===e.offset},O=function(e){return e.offset===L(e.node)},j=function(e){return z(e)||O(e)},V=function(e,t){for(;e&&e!==t;){if(0!==K(e))return!1;e=e.parentNode}return!0},q=function(e,t){for(;e&&e!==t;){if(K(e)!==L(e.parentNode)-1)return!1;e=e.parentNode}return!0},K=function(e){for(var t=0;e=e.previousSibling;)t+=1;return t},W=function(e){return!!(e&&e.childNodes&&e.childNodes.length)},_=function(e,n){var o,r;if(0===e.offset){if(t(e.node))return null;o=e.node.parentNode,r=K(e.node)}else W(e.node)?(o=e.node.childNodes[e.offset-1],r=L(o)):(o=e.node,r=n?0:e.offset-1);return{node:o,offset:r}},Y=function(e,n){var o,r;if(L(e.node)===e.offset){if(t(e.node))return null;o=e.node.parentNode,r=K(e.node)+1}else W(e.node)?(o=e.node.childNodes[e.offset],r=0):(o=e.node,r=n?L(e.node):e.offset+1);return{node:o,offset:r}},Z=function(e,t){return e.node===t.node&&e.offset===t.offset},J=function(e){if(u(e.node)||!W(e.node)||S(e.node))return!0;var t=e.node.childNodes[e.offset-1],n=e.node.childNodes[e.offset];return t&&!f(t)||n&&!f(n)?!1:!0},G=function(e,t){for(;e;){if(t(e))return e;e=_(e)}return null},Q=function(e,t){for(;e;){if(t(e))return e;e=Y(e)}return null},X=function(e,t,n,o){for(var r=e;r&&(n(r),!Z(r,t));){var i=o&&e.node!==r.node&&t.node!==r.node;r=Y(r,i)}},$=function(t,n){var o=M(n,i.eq(t));return e.map(o,K).reverse()},et=function(e,t){for(var n=e,o=0,r=t.length;r>o;o++)n=n.childNodes.length<=t[o]?n.childNodes[n.childNodes.length-1]:n.childNodes[t[o]];return n},tt=function(e,t){if(u(e.node))return z(e)?e.node:O(e)?e.node.nextSibling:e.node.splitText(e.offset);var n=e.node.childNodes[e.offset],o=U(e.node.cloneNode(!1),e.node);return B(o,D(n)),t||(F(e.node),F(o)),o},nt=function(e,t,n){var o=M(t.node,i.eq(e));return o.length?1===o.length?tt(t,n):o.reduce(function(e,o){var r=U(o.cloneNode(!1),o);return e===t.node&&(e=tt(t,n)),B(r,D(e)),n||(F(o),F(r)),r}):null},ot=function(e){return document.createElement(e)},rt=function(e){return document.createTextNode(e)},it=function(e,t){if(e&&e.parentNode){if(e.removeNode)return e.removeNode(t);var n=e.parentNode;if(!t){var o,r,i=[];for(o=0,r=e.childNodes.length;r>o;o++)i.push(e.childNodes[o]);for(o=0,r=i.length;r>o;o++)n.insertBefore(i[o],e)}n.removeChild(e)}},at=function(e,n){for(;e&&!t(e)&&n(e);){var o=e.parentNode;it(e),e=o}},st=function(e,t){if(e.nodeName.toUpperCase()===t.toUpperCase())return e;var n=ot(t);return e.style.cssText&&(n.style.cssText=e.style.cssText),B(n,a.from(e.childNodes)),U(n,e),it(e),n},lt=c("TEXTAREA"),dt=function(t,n){var o=lt(t[0])?t.val():t.html();if(n){var r=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;o=o.replace(r,function(e,t,n){n=n.toUpperCase();var o=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(n)&&!!t,r=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(n);return e+(o||r?"\n":"")}),o=e.trim(o)}return o},ct=function(e){var t=e.val();return t.replace(/[\n\r]/g,"")};return{NBSP_CHAR:s,ZERO_WIDTH_NBSP_CHAR:l,blank:N,emptyPara:"<p>"+N+"</p>",isEditable:t,isControlSizing:n,buildLayoutInfo:o,isText:u,isPara:h,isPurePara:v,isInline:g,isBodyInline:T,isBody:x,isParaInline:k,isList:m,isTable:c("TABLE"),isCell:b,isBlockquote:y,isBodyContainer:C,isAnchor:w,isDiv:c("DIV"),isLi:p,isSpan:c("SPAN"),isB:c("B"),isU:c("U"),isS:c("S"),isI:c("I"),isImg:c("IMG"),isTextarea:lt,isEmpty:S,isEmptyAnchor:i.and(w,S),nodeLength:L,isLeftEdgePoint:z,isRightEdgePoint:O,isEdgePoint:j,isLeftEdgeOf:V,isRightEdgeOf:q,prevPoint:_,nextPoint:Y,isSamePoint:Z,isVisiblePoint:J,prevPointUntil:G,nextPointUntil:Q,walkPoint:X,ancestor:E,listAncestor:M,lastAncestor:R,listNext:D,listPrev:I,listDescendant:P,commonAncestor:A,wrap:H,insertAfter:U,appendChildNodes:B,position:K,hasChildren:W,makeOffsetPath:$,fromOffsetPath:et,splitTree:nt,create:ot,createText:rt,remove:it,removeWhile:at,replace:st,html:dt,value:ct}}(),c={version:"0.5.9",options:{width:null,height:null,minHeight:null,maxHeight:null,focus:!1,tabsize:4,styleWithSpan:!0,disableLinkTarget:!1,disableDragAndDrop:!1,disableResizeEditor:!1,codemirror:{mode:"text/html",htmlMode:!0,lineNumbers:!0},lang:"en-US",direction:null,toolbar:[["style",["style"]],["font",["bold","italic","underline","superscript","subscript","strikethrough","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],airMode:!1,airPopover:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]],styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],defaultFontName:"Helvetica Neue",fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Impact","Lucida Grande","Tahoma","Times New Roman","Verdana"],colors:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],fontSizes:["8","9","10","11","12","14","18","24","36"],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],insertTableMaxSize:{col:10,row:10},oninit:null,onfocus:null,onblur:null,onenter:null,onkeyup:null,onkeydown:null,onImageUpload:null,onImageUploadError:null,onToolbarClick:null,onCreateLink:function(e){return-1!==e.indexOf("@")&&-1===e.indexOf(":")?e="mailto:"+e:-1===e.indexOf("://")&&(e="http://"+e),e},keyMap:{pc:{ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"showLinkDialog"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"showLinkDialog"}}},lang:{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",clear:"Remove Font Style",height:"Line Height",name:"Font Family",size:"Font Size"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",dragImageHere:"Drag an image here",selectFromFiles:"Select from files",url:"Image URL",remove:"Remove Image"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},video:{video:"Video",videoLink:"Video Link",insert:"Insert Video",url:"Video URL?",providers:"(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style"},history:{undo:"Undo",redo:"Redo"}}}},u=function(){var t=function(t){return e.Deferred(function(n){e.extend(new FileReader,{onload:function(e){var t=e.target.result;n.resolve(t)},onerror:function(){n.reject(this)}}).readAsDataURL(t)}).promise()},n=function(t,n){return e.Deferred(function(o){e("<img>").one("load",function(){o.resolve(e(this))}).one("error abort",function(){o.reject(e(this))}).css({display:"none"}).appendTo(document.body).attr("src",t).attr("data-filename",n)}).promise()};return{readFileAsDataURL:t,createImage:n}}(),f={isEdit:function(e){return-1!==[8,9,13,32].indexOf(e)},nameFromCode:{8:"BACKSPACE",9:"TAB",13:"ENTER",32:"SPACE",48:"NUM0",49:"NUM1",50:"NUM2",51:"NUM3",52:"NUM4",53:"NUM5",54:"NUM6",55:"NUM7",56:"NUM8",66:"B",69:"E",73:"I",74:"J",75:"K",76:"L",82:"R",83:"S",85:"U",89:"Y",90:"Z",191:"SLASH",219:"LEFTBRACKET",220:"BACKSLASH",221:"RIGHTBRACKET"}},h=function(){var t=function(t,n){if(r.jqueryVersion<1.9){var o={};return e.each(n,function(e,n){o[n]=t.css(n)}),o}return t.css.call(t,n)};this.stylePara=function(t,n){e.each(t.nodes(d.isPara,{includeAncestor:!0}),function(t,o){e(o).css(n)})},this.current=function(n,o){var r=e(d.isText(n.sc)?n.sc.parentNode:n.sc),i=["font-family","font-size","text-align","list-style-type","line-height"],a=t(r,i)||{};if(a["font-size"]=parseInt(a["font-size"],10),a["font-bold"]=document.queryCommandState("bold")?"bold":"normal",a["font-italic"]=document.queryCommandState("italic")?"italic":"normal",a["font-underline"]=document.queryCommandState("underline")?"underline":"normal",a["font-strikethrough"]=document.queryCommandState("strikeThrough")?"strikethrough":"normal",a["font-superscript"]=document.queryCommandState("superscript")?"superscript":"normal",a["font-subscript"]=document.queryCommandState("subscript")?"subscript":"normal",n.isOnList()){var s=["circle","disc","disc-leading-zero","square"],l=e.inArray(a["list-style-type"],s)>-1;a["list-style"]=l?"unordered":"ordered"}else a["list-style"]="none";var c=d.ancestor(n.sc,d.isPara);if(c&&c.style["line-height"])a["line-height"]=c.style.lineHeight;else{var u=parseInt(a["line-height"],10)/parseInt(a["font-size"],10);a["line-height"]=u.toFixed(1)}return a.image=d.isImg(o)&&o,a.anchor=n.isOnAnchor()&&d.ancestor(n.sc,d.isAnchor),a.ancestors=d.listAncestor(n.sc,d.isEditable),a.range=n,a}},p=function(){var t=function(e,t){var n,o,r=e.parentElement(),i=document.body.createTextRange(),s=a.from(r.childNodes);for(n=0;n<s.length;n++)if(!d.isText(s[n])){if(i.moveToElementText(s[n]),i.compareEndPoints("StartToStart",e)>=0)break;o=s[n]}if(0!==n&&d.isText(s[n-1])){var l=document.body.createTextRange(),c=null;l.moveToElementText(o||r),l.collapse(!o),c=o?o.nextSibling:r.firstChild;var u=e.duplicate();u.setEndPoint("StartToStart",l);for(var f=u.text.replace(/[\r\n]/g,"").length;f>c.nodeValue.length&&c.nextSibling;)f-=c.nodeValue.length,c=c.nextSibling;c.nodeValue,t&&c.nextSibling&&d.isText(c.nextSibling)&&f===c.nodeValue.length&&(f-=c.nodeValue.length,c=c.nextSibling),r=c,n=f}return{cont:r,offset:n}},n=function(e){var t=function(e,n){var o,r;if(d.isText(e)){var s=d.listPrev(e,i.not(d.isText)),l=a.last(s).previousSibling;o=l||e.parentNode,n+=a.sum(a.tail(s),d.nodeLength),r=!l}else{if(o=e.childNodes[n]||e,d.isText(o))return t(o,0);n=0,r=!1}return{node:o,collapseToStart:r,offset:n}},n=document.body.createTextRange(),o=t(e.node,e.offset);return n.moveToElementText(o.node),n.collapse(o.collapseToStart),n.moveStart("character",o.offset),n},o=function(t,s,l,c){this.sc=t,this.so=s,this.ec=l,this.eo=c;var u=function(){if(r.isW3CRangeSupport){var e=document.createRange();return e.setStart(t,s),e.setEnd(l,c),e}var o=n({node:t,offset:s});return o.setEndPoint("EndToEnd",n({node:l,offset:c})),o};this.getPoints=function(){return{sc:t,so:s,ec:l,eo:c}},this.getStartPoint=function(){return{node:t,offset:s}},this.getEndPoint=function(){return{node:l,offset:c}},this.select=function(){var e=u();if(r.isW3CRangeSupport){var t=document.getSelection();t.rangeCount>0&&t.removeAllRanges(),t.addRange(e)}else e.select()},this.normalize=function(){var e=function(e){return d.isVisiblePoint(e)||(d.isLeftEdgePoint(e)?e=d.nextPointUntil(e,d.isVisiblePoint):d.isRightEdgePoint(e)&&(e=d.prevPointUntil(e,d.isVisiblePoint))),e},t=e(this.getStartPoint()),n=e(this.getStartPoint());return new o(t.node,t.offset,n.node,n.offset)},this.nodes=function(e,t){e=e||i.ok;var n=t&&t.includeAncestor,o=t&&t.fullyContains,r=this.getStartPoint(),s=this.getEndPoint(),l=[],c=[];return d.walkPoint(r,s,function(t){if(!d.isEditable(t.node)){var r;o?(d.isLeftEdgePoint(t)&&c.push(t.node),d.isRightEdgePoint(t)&&a.contains(c,t.node)&&(r=t.node)):r=n?d.ancestor(t.node,e):t.node,r&&e(r)&&l.push(r)}},!0),a.unique(l)},this.commonAncestor=function(){return d.commonAncestor(t,l)},this.expand=function(e){var n=d.ancestor(t,e),r=d.ancestor(l,e);if(!n&&!r)return new o(t,s,l,c);var i=this.getPoints();return n&&(i.sc=n,i.so=0),r&&(i.ec=r,i.eo=d.nodeLength(r)),new o(i.sc,i.so,i.ec,i.eo)},this.collapse=function(e){return e?new o(t,s,t,s):new o(l,c,l,c)},this.splitText=function(){var e=t===l,n=this.getPoints();return d.isText(l)&&!d.isEdgePoint(this.getEndPoint())&&l.splitText(c),d.isText(t)&&!d.isEdgePoint(this.getStartPoint())&&(n.sc=t.splitText(s),n.so=0,e&&(n.ec=n.sc,n.eo=c-s)),new o(n.sc,n.so,n.ec,n.eo)},this.deleteContents=function(){if(this.isCollapsed())return this;var t=this.splitText(),n=t.nodes(null,{fullyContains:!0}),r=d.prevPointUntil(t.getStartPoint(),function(e){return!a.contains(n,e.node)}),i=[];return e.each(n,function(e,t){var n=t.parentNode;r.node!==n&&1===d.nodeLength(n)&&i.push(n),d.remove(t,!1)}),e.each(i,function(e,t){d.remove(t,!1)}),new o(r.node,r.offset,r.node,r.offset)};var f=function(e){return function(){var n=d.ancestor(t,e);return!!n&&n===d.ancestor(l,e)}};this.isOnEditable=f(d.isEditable),this.isOnList=f(d.isList),this.isOnAnchor=f(d.isAnchor),this.isOnCell=f(d.isCell),this.isLeftEdgeOf=function(e){if(!d.isLeftEdgePoint(this.getStartPoint()))return!1;var t=d.ancestor(this.sc,e);return t&&d.isLeftEdgeOf(this.sc,t)},this.isCollapsed=function(){return t===l&&s===c},this.wrapBodyInlineWithPara=function(){if(d.isEditable(t)&&!t.childNodes[s])return new o(t.appendChild(e(d.emptyPara)[0]),0);if(!d.isInline(t)||d.isParaInline(t))return this;var n=d.listAncestor(t,i.not(d.isInline)),r=a.last(n);d.isInline(r)||(r=n[n.length-2]||t.childNodes[s]);var l=d.listPrev(r,d.isParaInline).reverse();if(l=l.concat(d.listNext(r.nextSibling,d.isParaInline)),l.length){var c=d.wrap(a.head(l),"p");d.appendChildNodes(c,a.tail(l))}return this},this.insertNode=function(e,t){var n,o,r,i=this.wrapBodyInlineWithPara(),s=i.getStartPoint();if(t)o=d.isPara(s.node)?s.node:s.node.parentNode,r=d.isPara(s.node)?s.node.childNodes[s.offset]:d.splitTree(s.node,s);else{var l=d.listAncestor(s.node,d.isBodyContainer),c=a.last(l)||s.node;d.isBodyContainer(c)?(n=l[l.length-2],o=c):(n=c,o=n.parentNode),r=n&&d.splitTree(n,s)}return r?r.parentNode.insertBefore(e,r):o.appendChild(e),e},this.toString=function(){var e=u();return r.isW3CRangeSupport?e.toString():e.text},this.bookmark=function(e){return{s:{path:d.makeOffsetPath(e,t),offset:s},e:{path:d.makeOffsetPath(e,l),offset:c}}},this.getClientRects=function(){var e=u();return e.getClientRects()}};return{create:function(e,n,i,a){if(arguments.length)2===arguments.length&&(i=e,a=n);else if(r.isW3CRangeSupport){var s=document.getSelection();if(0===s.rangeCount)return null;if(d.isBody(s.anchorNode))return null;var l=s.getRangeAt(0);e=l.startContainer,n=l.startOffset,i=l.endContainer,a=l.endOffset}else{var c=document.selection.createRange(),u=c.duplicate();u.collapse(!1);var f=c;f.collapse(!0);var h=t(f,!0),p=t(u,!1);e=h.cont,n=h.offset,i=p.cont,a=p.offset}return new o(e,n,i,a)},createFromNode:function(e){return this.create(e,0,e,1)},createFromBookmark:function(e,t){var n=d.fromOffsetPath(e,t.s.path),r=t.s.offset,i=d.fromOffsetPath(e,t.e.path),a=t.e.offset;return new o(n,r,i,a)}}}(),v=function(){this.insertTab=function(e,t,n){var o=d.createText(new Array(n+1).join(d.NBSP_CHAR));t=t.deleteContents(),t.insertNode(o,!0),t=p.create(o,n),t.select()},this.insertParagraph=function(){var t=p.create();t=t.deleteContents(),t=t.wrapBodyInlineWithPara();var n=d.ancestor(t.sc,d.isPara),o=d.splitTree(n,t.getStartPoint()),r=d.listDescendant(n,d.isEmptyAnchor);r=r.concat(d.listDescendant(o,d.isEmptyAnchor)),e.each(r,function(e,t){d.remove(t)}),p.create(o,0).normalize().select()}},g=function(){this.tab=function(e,t){var n=d.ancestor(e.commonAncestor(),d.isCell),o=d.ancestor(n,d.isTable),r=d.listDescendant(o,d.isCell),i=a[t?"prev":"next"](r,n);i&&p.create(i,0).select()},this.createTable=function(t,n){for(var o,r=[],i=0;t>i;i++)r.push("<td>"+d.blank+"</td>");o=r.join("");for(var a,s=[],l=0;n>l;l++)s.push("<tr>"+o+"</tr>");return a=s.join(""),e('<table class="table table-bordered">'+a+"</table>")[0]}},m=function(){this.insertOrderedList=function(){this.toggleList("OL")},this.insertUnorderedList=function(){this.toggleList("UL")},this.indent=function(){var t=this,n=p.create().wrapBodyInlineWithPara(),o=n.nodes(d.isPara,{includeAncestor:!0}),r=a.clusterBy(o,i.peq2("parentNode"));e.each(r,function(n,o){var r=a.head(o);d.isLi(r)?t.wrapList(o,r.parentNode.nodeName):e.each(o,function(t,n){e(n).css("marginLeft",function(e,t){return(parseInt(t,10)||0)+25})})}),n.select()},this.outdent=function(){var t=this,n=p.create().wrapBodyInlineWithPara(),o=n.nodes(d.isPara,{includeAncestor:!0}),r=a.clusterBy(o,i.peq2("parentNode"));e.each(r,function(n,o){var r=a.head(o);d.isLi(r)?t.releaseList([o]):e.each(o,function(t,n){e(n).css("marginLeft",function(e,t){return t=parseInt(t,10)||0,t>25?t-25:""})})}),n.select()},this.toggleList=function(t){var n=this,o=p.create().wrapBodyInlineWithPara(),r=o.nodes(d.isPara,{includeAncestor:!0}),s=a.clusterBy(r,i.peq2("parentNode"));if(a.find(r,d.isPurePara))e.each(s,function(e,o){n.wrapList(o,t)});else{var l=o.nodes(d.isList,{includeAncestor:!0}).filter(function(n){return!e.nodeName(n,t)});l.length?e.each(l,function(e,n){d.replace(n,t)}):this.releaseList(s,!0)}o.select()},this.wrapList=function(t,n){var o=a.head(t),r=a.last(t),i=d.isList(o.previousSibling)&&o.previousSibling,s=d.isList(r.nextSibling)&&r.nextSibling,l=i||d.insertAfter(d.create(n||"UL"),r);t=e.map(t,function(e){return d.isPurePara(e)?d.replace(e,"LI"):e}),d.appendChildNodes(l,t),s&&(d.appendChildNodes(l,a.from(s.childNodes)),d.remove(s))},this.releaseList=function(t,n){var o=[];return e.each(t,function(t,r){var i=a.head(r),s=a.last(r),l=n?d.lastAncestor(i,d.isList):i.parentNode,c=l.childNodes.length>1?d.splitTree(l,{node:s.parentNode,offset:d.position(s)+1},!0):null,u=d.splitTree(l,{node:i.parentNode,offset:d.position(i)},!0);r=n?d.listDescendant(u,d.isLi):a.from(u.childNodes).filter(d.isLi),(n||!d.isList(l.parentNode))&&(r=e.map(r,function(e){return d.replace(e,"P")})),e.each(a.from(r).reverse(),function(e,t){d.insertAfter(t,l)});var f=a.compact([l,u,c]);e.each(f,function(t,n){var o=[n].concat(d.listDescendant(n,d.isList));e.each(o.reverse(),function(e,t){d.nodeLength(t)||d.remove(t,!0)})}),o=o.concat(r)}),o}},b=function(){var t=new h,n=new g,o=new v,i=new m;this.saveRange=function(e,t){e.focus(),e.data("range",p.create()),t&&p.create().collapse().select()},this.restoreRange=function(e){var t=e.data("range");t&&(t.select(),e.focus())},this.currentStyle=function(e){var n=p.create();return n?n.isOnEditable()&&t.current(n,e):!1};var s=this.triggerOnChange=function(e){var t=e.data("callbacks").onChange;t&&t(e.html(),e)};this.undo=function(e){e.data("NoteHistory").undo(),s(e)},this.redo=function(e){e.data("NoteHistory").redo(),s(e)};for(var l=this.afterCommand=function(e){e.data("NoteHistory").recordUndo(),s(e)},c=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","insertHorizontalRule","fontName"],f=0,b=c.length;b>f;f++)this[c[f]]=function(e){return function(t,n){document.execCommand(e,!1,n),l(t)}}(c[f]);this.tab=function(e,t){var r=p.create();r.isCollapsed()&&r.isOnCell()?n.tab(r):(o.insertTab(e,r,t.tabsize),l(e))},this.untab=function(){var e=p.create();e.isCollapsed()&&e.isOnCell()&&n.tab(e,!0)},this.insertParagraph=function(e){o.insertParagraph(e),l(e)},this.insertOrderedList=function(e){i.insertOrderedList(e),l(e)},this.insertUnorderedList=function(e){i.insertUnorderedList(e),l(e)},this.indent=function(e){i.indent(e),l(e)},this.outdent=function(e){i.outdent(e),l(e)},this.insertImage=function(e,t,n){u.createImage(t,n).then(function(t){t.css({display:"",width:Math.min(e.width(),t.width())}),p.create().insertNode(t[0]),l(e)}).fail(function(){var t=e.data("callbacks");t.onImageUploadError&&t.onImageUploadError()})},this.insertVideo=function(t,n){var o,r=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,i=n.match(r),a=/\/\/instagram.com\/p\/(.[a-zA-Z0-9]*)/,s=n.match(a),d=/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/,c=n.match(d),u=/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/,f=n.match(u),h=/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/,v=n.match(h),g=/\/\/v\.youku\.com\/v_show\/id_(\w+)\.html/,m=n.match(g);if(i&&11===i[2].length){var b=i[2];o=e("<iframe>").attr("src","//www.youtube.com/embed/"+b).attr("width","640").attr("height","360")}else s&&s[0].length?o=e("<iframe>").attr("src",s[0]+"/embed/").attr("width","612").attr("height","710").attr("scrolling","no").attr("allowtransparency","true"):c&&c[0].length?o=e("<iframe>").attr("src",c[0]+"/embed/simple").attr("width","600").attr("height","600").attr("class","vine-embed"):f&&f[3].length?o=e("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("src","//player.vimeo.com/video/"+f[3]).attr("width","640").attr("height","360"):v&&v[2].length?o=e("<iframe>").attr("src","//www.dailymotion.com/embed/video/"+v[2]).attr("width","640").attr("height","360"):m&&m[1].length&&(o=e("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("height","498").attr("width","510").attr("src","//player.youku.com/embed/"+m[1]));o&&(o.attr("frameborder",0),p.create().insertNode(o[0]),l(t))},this.formatBlock=function(e,t){t=r.isMSIE?"<"+t+">":t,document.execCommand("FormatBlock",!1,t),l(e)},this.formatPara=function(e){this.formatBlock(e,"P"),l(e)};for(var f=1;6>=f;f++)this["formatH"+f]=function(e){return function(t){this.formatBlock(t,"H"+e)}}(f);this.fontSize=function(e,t){document.execCommand("fontSize",!1,3),r.isFF?e.find("font[size=3]").removeAttr("size").css("font-size",t+"px"):e.find("span").filter(function(){return"medium"===this.style.fontSize}).css("font-size",t+"px"),l(e)},this.lineHeight=function(e,n){t.stylePara(p.create(),{lineHeight:n}),l(e)},this.unlink=function(e){var t=p.create();if(t.isOnAnchor()){var n=d.ancestor(t.sc,d.isAnchor);t=p.createFromNode(n),t.select(),document.execCommand("unlink"),l(e)}},this.createLink=function(t,n,o){var r=n.url,i=n.text,a=n.newWindow,s=n.range;o.onCreateLink&&(r=o.onCreateLink(r)),s=s.deleteContents();var d=s.insertNode(e("<A>"+i+"</A>")[0],!0);e(d).attr({href:r,target:a?"_blank":""}),p.createFromNode(d).select(),l(t)},this.getLinkInfo=function(t){t.focus();var n=p.create().expand(d.isAnchor),o=e(a.head(n.nodes(d.isAnchor)));return{range:n,text:n.toString(),isNewWindow:o.length?"_blank"===o.attr("target"):!0,url:o.length?o.attr("href"):""}},this.getVideoInfo=function(e){e.focus();var t=p.create();if(t.isOnAnchor()){var n=d.ancestor(t.sc,d.isAnchor);t=p.createFromNode(n)}return{text:t.toString()}},this.color=function(e,t){var n=JSON.parse(t),o=n.foreColor,r=n.backColor;o&&document.execCommand("foreColor",!1,o),r&&document.execCommand("backColor",!1,r),l(e)},this.insertTable=function(e,t){var o=t.split("x"),r=p.create();r=r.deleteContents(),r.insertNode(n.createTable(o[0],o[1])),l(e)},this.floatMe=function(e,t,n){n.css("float",t),l(e)},this.resize=function(e,t,n){n.css({width:e.width()*t+"px",height:""}),l(e)},this.resizeTo=function(e,t,n){var o;if(n){var r=e.y/e.x,i=t.data("ratio");o={width:i>r?e.x:e.y/i,height:i>r?e.x*i:e.y}}else o={width:e.x,height:e.y};t.css(o)},this.removeMedia=function(e,t,n){n.detach(),l(e)}},y=function(e){var t=[],n=0,o=e[0],r=function(){var t=p.create(),n={s:{path:[0],offset:0},e:{path:[0],offset:0}};return{contents:e.html(),bookmark:t?t.bookmark(o):n}},i=function(t){null!==t.contents&&e.html(t.contents),null!==t.bookmark&&p.createFromBookmark(o,t.bookmark).select()};this.undo=function(){n>0&&(n--,i(t[n]))},this.redo=function(){t.length-1>n&&(n++,i(t[n]))},this.recordUndo=function(){t.length>n&&(t=t.slice(0,n)),t.push(r()),n++},this.recordUndo()},C=function(){this.update=function(t,n){var o=function(t,n){t.find(".dropdown-menu li a").each(function(){var t=e(this).data("value")+""==n+"";this.className=t?"checked":""})},r=function(e,n){var o=t.find(e);o.toggleClass("active",n())},i=t.find(".note-fontname");if(i.length){var s=n["font-family"];s&&(s=a.head(s.split(",")),s=s.replace(/\'/g,""),i.find(".note-current-fontname").text(s),o(i,s))}var l=t.find(".note-fontsize");l.find(".note-current-fontsize").text(n["font-size"]),o(l,parseFloat(n["font-size"]));var d=t.find(".note-height");o(d,parseFloat(n["line-height"])),r('button[data-event="bold"]',function(){return"bold"===n["font-bold"]}),r('button[data-event="italic"]',function(){return"italic"===n["font-italic"]
}),r('button[data-event="underline"]',function(){return"underline"===n["font-underline"]}),r('button[data-event="strikethrough"]',function(){return"strikethrough"===n["font-strikethrough"]}),r('button[data-event="superscript"]',function(){return"superscript"===n["font-superscript"]}),r('button[data-event="subscript"]',function(){return"subscript"===n["font-subscript"]}),r('button[data-event="justifyLeft"]',function(){return"left"===n["text-align"]||"start"===n["text-align"]}),r('button[data-event="justifyCenter"]',function(){return"center"===n["text-align"]}),r('button[data-event="justifyRight"]',function(){return"right"===n["text-align"]}),r('button[data-event="justifyFull"]',function(){return"justify"===n["text-align"]}),r('button[data-event="insertUnorderedList"]',function(){return"unordered"===n["list-style"]}),r('button[data-event="insertOrderedList"]',function(){return"ordered"===n["list-style"]})},this.updateRecentColor=function(t,n,o){var r=e(t).closest(".note-color"),i=r.find(".note-recent-color"),a=JSON.parse(i.attr("data-value"));a[n]=o,i.attr("data-value",JSON.stringify(a));var s="backColor"===n?"background-color":"color";i.find("i").css(s,o)}},w=function(){var e=new C;this.update=function(t,n){e.update(t,n)},this.updateRecentColor=function(t,n,o){e.updateRecentColor(t,n,o)},this.activate=function(e){e.find("button").not('button[data-event="codeview"]').removeClass("disabled")},this.deactivate=function(e){e.find("button").not('button[data-event="codeview"]').addClass("disabled")},this.updateFullscreen=function(e,t){var n=e.find('button[data-event="fullscreen"]');n.toggleClass("active",t)},this.updateCodeview=function(e,t){var n=e.find('button[data-event="codeview"]');n.toggleClass("active",t)}},k=function(){var t=new C,n=function(t,n){var o=e(t),r=n?o.offset():o.position(),i=o.outerHeight(!0);return{left:r.left,top:r.top+i}},o=function(e,t){e.css({display:"block",left:t.left,top:t.top})},r=20;this.update=function(s,l,d){t.update(s,l);var c=s.find(".note-link-popover");if(l.anchor){var u=c.find("a"),f=e(l.anchor).attr("href");u.attr("href",f).html(f),o(c,n(l.anchor,d))}else c.hide();var h=s.find(".note-image-popover");l.image?o(h,n(l.image,d)):h.hide();var p=s.find(".note-air-popover");if(d&&!l.range.isCollapsed()){var v=i.rect2bnd(a.last(l.range.getClientRects()));o(p,{left:Math.max(v.left+v.width/2-r,0),top:v.top+v.height})}else p.hide()},this.updateRecentColor=function(e,t,n){e.updateRecentColor(e,t,n)},this.hide=function(e){e.children().hide()}},T=function(){this.update=function(t,n,o){var r=t.find(".note-control-selection");if(n.image){var i=e(n.image),a=o?i.offset():i.position(),s={w:i.outerWidth(!0),h:i.outerHeight(!0)};r.css({display:"block",left:a.left,top:a.top,width:s.w,height:s.h}).data("target",n.image);var l=s.w+"x"+s.h;r.find(".note-control-selection-info").text(l)}else r.hide()},this.hide=function(e){e.children().hide()}},x=function(){var t=function(e,t){e.toggleClass("disabled",!t),e.attr("disabled",!t)};this.showImageDialog=function(n,o){return e.Deferred(function(e){var n=o.find(".note-image-dialog"),r=o.find(".note-image-input"),i=o.find(".note-image-url"),a=o.find(".note-image-btn");n.one("shown.bs.modal",function(){r.replaceWith(r.clone().on("change",function(){e.resolve(this.files),n.modal("hide")}).val("")),a.click(function(t){t.preventDefault(),e.resolve(i.val()),n.modal("hide")}),i.on("keyup paste",function(e){var n;n="paste"===e.type?e.originalEvent.clipboardData.getData("text"):i.val(),t(a,n)}).val("").trigger("focus")}).one("hidden.bs.modal",function(){r.off("change"),i.off("keyup paste"),a.off("click"),"pending"===e.state()&&e.reject()}).modal("show")})},this.showVideoDialog=function(n,o,r){return e.Deferred(function(e){var n=o.find(".note-video-dialog"),i=n.find(".note-video-url"),a=n.find(".note-video-btn");n.one("shown.bs.modal",function(){i.val(r.text).keyup(function(){t(a,i.val())}).trigger("keyup").trigger("focus"),a.click(function(t){t.preventDefault(),e.resolve(i.val()),n.modal("hide")})}).one("hidden.bs.modal",function(){i.off("keyup"),a.off("click"),"pending"===e.state()&&e.reject()}).modal("show")})},this.showLinkDialog=function(n,o,r){return e.Deferred(function(e){var n=o.find(".note-link-dialog"),i=n.find(".note-link-text"),a=n.find(".note-link-url"),s=n.find(".note-link-btn"),l=n.find("input[type=checkbox]");n.one("shown.bs.modal",function(){i.val(r.text),i.keyup(function(){r.text=i.val()}),r.url||(r.url=r.text,t(s,r.text)),a.keyup(function(){t(s,a.val()),r.text||i.val(a.val())}).val(r.url).trigger("focus").trigger("select"),l.prop("checked",r.newWindow),s.one("click",function(t){t.preventDefault(),e.resolve({range:r.range,url:a.val(),text:i.val(),newWindow:l.is(":checked")}),n.modal("hide")})}).one("hidden.bs.modal",function(){i.off("keyup"),a.off("keyup"),s.off("click"),"pending"===e.state()&&e.reject()}).modal("show")}).promise()},this.showHelpDialog=function(t,n){return e.Deferred(function(e){var t=n.find(".note-help-dialog");t.one("hidden.bs.modal",function(){e.resolve()}).modal("show")}).promise()}};r.hasCodeMirror&&(r.isSupportAmd?require(["CodeMirror"],function(e){t=e}):t=window.CodeMirror);var N=function(){var n=e(window),o=e(document),i=e("html, body"),s=new b,l=new w,c=new k,h=new T,p=new x,v=function(t){var n=e(t).closest(".note-editor, .note-air-editor, .note-air-layout");if(!n.length)return null;var o;return o=n.is(".note-editor, .note-air-editor")?n:e("#note-editor-"+a.last(n.attr("id").split("-"))),d.buildLayoutInfo(o)},g=function(t,n){s.restoreRange(t);var o=t.data("callbacks");o.onImageUpload?o.onImageUpload(n,s,t):e.each(n,function(e,n){var r=n.name;u.readFileAsDataURL(n).then(function(e){s.insertImage(t,e,r)}).fail(function(){o.onImageUploadError&&o.onImageUploadError()})})},m={showLinkDialog:function(e){var t=e.editor(),n=e.dialog(),o=e.editable(),r=s.getLinkInfo(o),i=t.data("options");s.saveRange(o),p.showLinkDialog(o,n,r).then(function(t){s.restoreRange(o),s.createLink(o,t,i),c.hide(e.popover())}).fail(function(){s.restoreRange(o)})},showImageDialog:function(e){var t=e.dialog(),n=e.editable();s.saveRange(n),p.showImageDialog(n,t).then(function(e){s.restoreRange(n),"string"==typeof e?s.insertImage(n,e):g(n,e)}).fail(function(){s.restoreRange(n)})},showVideoDialog:function(e){var t=e.dialog(),n=e.editable(),o=s.getVideoInfo(n);s.saveRange(n),p.showVideoDialog(n,t,o).then(function(e){s.restoreRange(n),s.insertVideo(n,e)}).fail(function(){s.restoreRange(n)})},showHelpDialog:function(e){var t=e.dialog(),n=e.editable();s.saveRange(n,!0),p.showHelpDialog(n,t).then(function(){s.restoreRange(n)})},fullscreen:function(e){var t=e.editor(),o=e.toolbar(),r=e.editable(),a=e.codable(),s=t.data("options"),d=function(e){t.css("width",e.w),r.css("height",e.h),a.css("height",e.h),a.data("cmeditor")&&a.data("cmeditor").setsize(null,e.h)};t.toggleClass("fullscreen");var c=t.hasClass("fullscreen");c?(r.data("orgheight",r.css("height")),n.on("resize",function(){d({w:n.width(),h:n.height()-o.outerHeight()})}).trigger("resize"),i.css("overflow","hidden")):(n.off("resize"),d({w:s.width||"",h:r.data("orgheight")}),i.css("overflow","visible")),l.updateFullscreen(o,c)},codeview:function(e){var n,o,i=e.editor(),a=e.toolbar(),s=e.editable(),u=e.codable(),f=e.popover(),h=i.data("options");i.toggleClass("codeview");var p=i.hasClass("codeview");p?(u.val(d.html(s,!0)),u.height(s.height()),l.deactivate(a),c.hide(f),u.focus(),r.hasCodeMirror&&(n=t.fromTextArea(u[0],h.codemirror),h.codemirror.tern&&(o=new t.TernServer(h.codemirror.tern),n.ternServer=o,n.on("cursorActivity",function(e){o.updateArgHints(e)})),n.setSize(null,s.outerHeight()),u.data("cmEditor",n))):(r.hasCodeMirror&&(n=u.data("cmEditor"),u.val(n.getValue()),n.toTextArea()),s.html(d.value(u)||d.emptyPara),s.height(h.height?u.height():"auto"),l.activate(a),s.focus()),l.updateCodeview(e.toolbar(),p)}},C=function(e){d.isImg(e.target)&&e.preventDefault()},N=function(e){setTimeout(function(){var t=v(e.currentTarget||e.target),n=s.currentStyle(e.target);if(n){var o=t.editor().data("options").airMode;o||l.update(t.toolbar(),n),c.update(t.popover(),n,o),h.update(t.handle(),n,o)}},0)},L=function(e){var t=v(e.currentTarget||e.target);c.hide(t.popover()),h.hide(t.handle())},S=function(e){var t=e.originalEvent.clipboardData;if(t&&t.items&&t.items.length){var n=v(e.currentTarget||e.target),o=a.head(t.items),r="file"===o.kind&&-1!==o.type.indexOf("image/");r&&g(n.editable(),[o.getAsFile()])}},F=function(t){if(d.isControlSizing(t.target)){t.preventDefault(),t.stopPropagation();var n=v(t.target),r=n.handle(),i=n.popover(),a=n.editable(),l=n.editor(),u=r.find(".note-control-selection").data("target"),f=e(u),p=f.offset(),g=o.scrollTop(),m=l.data("options").airMode;o.on("mousemove",function(e){s.resizeTo({x:e.clientX-p.left,y:e.clientY-(p.top-g)},f,!e.shiftKey),h.update(r,{image:u},m),c.update(i,{image:u},m)}).one("mouseup",function(){o.off("mousemove")}),f.data("ratio")||f.data("ratio",f.height()/f.width()),s.afterCommand(a)}},E=function(t){var n=e(t.target).closest("[data-event]");n.length&&t.preventDefault()},M=function(t){var n=e(t.target).closest("[data-event]");if(n.length){var o=n.attr("data-event"),r=n.attr("data-value"),i=n.attr("data-hide"),d=v(t.target);t.preventDefault();var u;if(-1!==e.inArray(o,["resize","floatMe","removeMedia"])){var f=d.handle().find(".note-control-selection");u=e(f.data("target"))}if(i&&n.parents(".popover").hide(),s[o]){var h=d.editable();h.trigger("focus"),s[o](h,r,u)}else m[o]&&m[o].call(this,d);if(-1!==e.inArray(o,["backColor","foreColor"])){var p=d.editor().data("options",p),g=p.airMode?c:l;g.updateRecentColor(a.head(n),o,r)}N(t)}},R=24,A=function(e){e.preventDefault(),e.stopPropagation();var t=v(e.target).editable(),n=t.offset().top-o.scrollTop(),r=v(e.currentTarget||e.target),i=r.editor().data("options");o.on("mousemove",function(e){var o=e.clientY-(n+R);o=i.minHeight>0?Math.max(o,i.minHeight):o,o=i.maxHeight>0?Math.min(o,i.maxHeight):o,t.height(o)}).one("mouseup",function(){o.off("mousemove")})},I=18,D=function(t,n){var o,r=e(t.target.parentNode),i=r.next(),a=r.find(".note-dimension-picker-mousecatcher"),s=r.find(".note-dimension-picker-highlighted"),l=r.find(".note-dimension-picker-unhighlighted");if(void 0===t.offsetX){var d=e(t.target).offset();o={x:t.pageX-d.left,y:t.pageY-d.top}}else o={x:t.offsetX,y:t.offsetY};var c={c:Math.ceil(o.x/I)||1,r:Math.ceil(o.y/I)||1};s.css({width:c.c+"em",height:c.r+"em"}),a.attr("data-value",c.c+"x"+c.r),3<c.c&&c.c<n.insertTableMaxSize.col&&l.css({width:c.c+1+"em"}),3<c.r&&c.r<n.insertTableMaxSize.row&&l.css({height:c.r+1+"em"}),i.html(c.c+" x "+c.r)},P=function(e,t){t?o.on("drop",function(e){e.preventDefault()}):H(e)},H=function(t){var n=e(),r=t.dropzone,i=t.dropzone.find(".note-dropzone-message");o.on("dragenter",function(e){var o=t.editor.hasClass("codeview");o||n.length||(t.editor.addClass("dragover"),r.width(t.editor.width()),r.height(t.editor.height()),i.text("Drag Image Here")),n=n.add(e.target)}).on("dragleave",function(e){n=n.not(e.target),n.length||t.editor.removeClass("dragover")}).on("drop",function(){n=e(),t.editor.removeClass("dragover")}),r.on("dragenter",function(){r.addClass("hover"),i.text("Drop Image")}).on("dragleave",function(){r.removeClass("hover"),i.text("Drag Image Here")}),r.on("drop",function(e){e.preventDefault();var t=e.originalEvent.dataTransfer;if(t&&t.files){var n=v(e.currentTarget||e.target);n.editable().focus(),g(n.editable(),t.files)}}).on("dragover",!1)};this.bindKeyMap=function(e,t){var n=e.editor,o=e.editable;e=v(o),o.on("keydown",function(r){var i=[];r.metaKey&&i.push("CMD"),r.ctrlKey&&!r.altKey&&i.push("CTRL"),r.shiftKey&&i.push("SHIFT");var a=f.nameFromCode[r.keyCode];a&&i.push(a);var l=t[i.join("+")];l?(r.preventDefault(),s[l]?s[l](o,n.data("options")):m[l]&&m[l].call(this,e)):f.isEdit(r.keyCode)&&s.afterCommand(o)})},this.attach=function(e,t){this.bindKeyMap(e,t.keyMap[r.isMac?"mac":"pc"]),e.editable.on("mousedown",C),e.editable.on("keyup mouseup",N),e.editable.on("scroll",L),e.editable.on("paste",S),e.handle.on("mousedown",F),e.popover.on("click",M),e.popover.on("mousedown",E),t.airMode||(P(e,t.disableDragAndDrop),e.toolbar.on("click",M),e.toolbar.on("mousedown",E),t.disableResizeEditor||e.statusbar.on("mousedown",A));var n=t.airMode?e.popover:e.toolbar,o=n.find(".note-dimension-picker-mousecatcher");o.css({width:t.insertTableMaxSize.col+"em",height:t.insertTableMaxSize.row+"em"}).on("mousemove",function(e){D(e,t)}),e.editor.data("options",t),t.styleWithSpan&&!r.isMSIE&&setTimeout(function(){document.execCommand("styleWithCSS",0,!0)},0);var i=new y(e.editable);if(e.editable.data("NoteHistory",i),t.onenter&&e.editable.keypress(function(e){e.keyCode===f.ENTER&&t.onenter(e)}),t.onfocus&&e.editable.focus(t.onfocus),t.onblur&&e.editable.blur(t.onblur),t.onkeyup&&e.editable.keyup(t.onkeyup),t.onkeydown&&e.editable.keydown(t.onkeydown),t.onpaste&&e.editable.on("paste",t.onpaste),t.onToolbarClick&&e.toolbar.click(t.onToolbarClick),t.onChange){var a=function(){s.triggerOnChange(e.editable)};if(r.isMSIE){var l="DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted";e.editable.on(l,a)}else e.editable.on("input",a)}e.editable.data("callbacks",{onChange:t.onChange,onAutoSave:t.onAutoSave,onImageUpload:t.onImageUpload,onImageUploadError:t.onImageUploadError,onFileUpload:t.onFileUpload,onFileUploadError:t.onFileUpload})},this.dettach=function(e,t){e.editable.off(),e.popover.off(),e.handle.off(),e.dialog.off(),t.airMode||(e.dropzone.off(),e.toolbar.off(),e.statusbar.off())}},L=function(){var t=function(e,t){var n=t.event,o=t.value,r=t.title,i=t.className,a=t.dropdown,s=t.hide;return'<button type="button" class="btn btn-default btn-sm btn-small'+(i?" "+i:"")+(a?" dropdown-toggle":"")+'"'+(a?' data-toggle="dropdown"':"")+(r?' title="'+r+'"':"")+(n?' data-event="'+n+'"':"")+(o?" data-value='"+o+"'":"")+(s?" data-hide='"+s+"'":"")+' tabindex="-1">'+e+(a?' <span class="caret"></span>':"")+"</button>"+(a||"")},n=function(e,n){var o='<i class="'+e+'"></i>';return t(o,n)},o=function(e,t){return'<div class="'+e+' popover bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content">'+t+"</div></div>"},a=function(e,t,n,o){return'<div class="'+e+' modal" aria-hidden="false"><div class="modal-dialog"><div class="modal-content">'+(t?'<div class="modal-header"><button type="button" class="close" aria-hidden="true" tabindex="-1">&times;</button><h4 class="modal-title">'+t+"</h4></div>":"")+'<form class="note-modal-form"><div class="modal-body"><div class="row-fluid">'+n+"</div></div>"+(o?'<div class="modal-footer">'+o+"</div>":"")+"</form></div></div></div>"},s={picture:function(e){return n("fa fa-picture-o icon-picture",{event:"showImageDialog",title:e.image.image,hide:!0})},link:function(e){return n("fa fa-link icon-link",{event:"showLinkDialog",title:e.link.link,hide:!0})},video:function(e){return n("fa fa-youtube-play icon-play",{event:"showVideoDialog",title:e.video.video,hide:!0})},table:function(e){var t='<ul class="note-table dropdown-menu"><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></ul>';return n("fa fa-table icon-table",{title:e.table.table,dropdown:t})},style:function(e,t){var o=t.styleTags.reduce(function(t,n){var o=e.style["p"===n?"normal":n];return t+'<li><a data-event="formatBlock" href="#" data-value="'+n+'">'+("p"===n||"pre"===n?o:"<"+n+">"+o+"</"+n+">")+"</a></li>"},"");return n("fa fa-magic icon-magic",{title:e.style.style,dropdown:'<ul class="dropdown-menu">'+o+"</ul>"})},fontname:function(e,n){var o=n.fontNames.reduce(function(e,t){return r.isFontInstalled(t)?e+'<li><a data-event="fontName" href="#" data-value="'+t+'"><i class="fa fa-check icon-ok"></i> '+t+"</a></li>":e},""),i='<span class="note-current-fontname">'+n.defaultFontName+"</span>";return t(i,{title:e.font.name,dropdown:'<ul class="dropdown-menu">'+o+"</ul>"})},fontsize:function(e,n){var o=n.fontSizes.reduce(function(e,t){return e+'<li><a data-event="fontSize" href="#" data-value="'+t+'"><i class="fa fa-check icon-ok"></i> '+t+"</a></li>"},""),r='<span class="note-current-fontsize">11</span>';return t(r,{title:e.font.size,dropdown:'<ul class="dropdown-menu">'+o+"</ul>"})},color:function(e){var n='<i class="fa fa-font icon-font" style="color:black;background-color:yellow;"></i>',o=t(n,{className:"note-recent-color",title:e.color.recent,event:"color",value:'{"backColor":"yellow"}'}),r='<ul class="dropdown-menu"><li><div class="btn-group"><div class="note-palette-title">'+e.color.background+'</div><div class="note-color-reset" data-event="backColor" data-value="inherit" title="'+e.color.transparent+'">'+e.color.setTransparent+'</div><div class="note-color-palette" data-target-event="backColor"></div></div><div class="btn-group"><div class="note-palette-title">'+e.color.foreground+'</div><div class="note-color-reset" data-event="foreColor" data-value="inherit" title="'+e.color.reset+'">'+e.color.resetToDefault+'</div><div class="note-color-palette" data-target-event="foreColor"></div></div></li></ul>',i=t("",{title:e.color.more,dropdown:r});return o+i},bold:function(e){return n("fa fa-bold icon-bold",{event:"bold",title:e.font.bold})},italic:function(e){return n("fa fa-italic icon-italic",{event:"italic",title:e.font.italic})},underline:function(e){return n("fa fa-underline icon-underline",{event:"underline",title:e.font.underline})},strikethrough:function(e){return n("fa fa-strikethrough icon-strikethrough",{event:"strikethrough",title:e.font.strikethrough})},superscript:function(e){return n("fa fa-superscript icon-superscript",{event:"superscript",title:e.font.superscript})},subscript:function(e){return n("fa fa-subscript icon-subscript",{event:"subscript",title:e.font.subscript})},clear:function(e){return n("fa fa-eraser icon-eraser",{event:"removeFormat",title:e.font.clear})},ul:function(e){return n("fa fa-list-ul icon-list-ul",{event:"insertUnorderedList",title:e.lists.unordered})},ol:function(e){return n("fa fa-list-ol icon-list-ol",{event:"insertOrderedList",title:e.lists.ordered})},paragraph:function(e){var t=n("fa fa-align-left icon-align-left",{title:e.paragraph.left,event:"justifyLeft"}),o=n("fa fa-align-center icon-align-center",{title:e.paragraph.center,event:"justifyCenter"}),r=n("fa fa-align-right icon-align-right",{title:e.paragraph.right,event:"justifyRight"}),i=n("fa fa-align-justify icon-align-justify",{title:e.paragraph.justify,event:"justifyFull"}),a=n("fa fa-outdent icon-indent-left",{title:e.paragraph.outdent,event:"outdent"}),s=n("fa fa-indent icon-indent-right",{title:e.paragraph.indent,event:"indent"}),l='<div class="dropdown-menu"><div class="note-align btn-group">'+t+o+r+i+'</div><div class="note-list btn-group">'+s+a+"</div></div>";return n("fa fa-align-left icon-align-left",{title:e.paragraph.paragraph,dropdown:l})},height:function(e,t){var o=t.lineHeights.reduce(function(e,t){return e+'<li><a data-event="lineHeight" href="#" data-value="'+parseFloat(t)+'"><i class="fa fa-check icon-ok"></i> '+t+"</a></li>"},"");return n("fa fa-text-height icon-text-height",{title:e.font.height,dropdown:'<ul class="dropdown-menu">'+o+"</ul>"})},help:function(e){return n("fa fa-question icon-question",{event:"showHelpDialog",title:e.options.help,hide:!0})},fullscreen:function(e){return n("fa fa-arrows-alt icon-fullscreen",{event:"fullscreen",title:e.options.fullscreen})},codeview:function(e){return n("fa fa-code icon-code",{event:"codeview",title:e.options.codeview})},undo:function(e){return n("fa fa-undo icon-undo",{event:"undo",title:e.history.undo})},redo:function(e){return n("fa fa-repeat icon-repeat",{event:"redo",title:e.history.redo})},hr:function(e){return n("fa fa-minus icon-hr",{event:"insertHorizontalRule",title:e.hr.insert})}},l=function(e,r){var i=function(){var t=n("fa fa-edit icon-edit",{title:e.link.edit,event:"showLinkDialog",hide:!0}),r=n("fa fa-unlink icon-unlink",{title:e.link.unlink,event:"unlink"}),i='<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group">'+t+r+"</div>";return o("note-link-popover",i)},a=function(){var r=t('<span class="note-fontsize-10">100%</span>',{title:e.image.resizeFull,event:"resize",value:"1"}),i=t('<span class="note-fontsize-10">50%</span>',{title:e.image.resizeHalf,event:"resize",value:"0.5"}),a=t('<span class="note-fontsize-10">25%</span>',{title:e.image.resizeQuarter,event:"resize",value:"0.25"}),s=n("fa fa-align-left icon-align-left",{title:e.image.floatLeft,event:"floatMe",value:"left"}),l=n("fa fa-align-right icon-align-right",{title:e.image.floatRight,event:"floatMe",value:"right"}),d=n("fa fa-align-justify icon-align-justify",{title:e.image.floatNone,event:"floatMe",value:"none"}),c=n("fa fa-trash-o icon-trash",{title:e.image.remove,event:"removeMedia",value:"none"}),u='<div class="btn-group">'+r+i+a+'</div><div class="btn-group">'+s+l+d+'</div><div class="btn-group">'+c+"</div>";return o("note-image-popover",u)},l=function(){for(var t="",n=0,i=r.airPopover.length;i>n;n++){var a=r.airPopover[n];t+='<div class="note-'+a[0]+' btn-group">';for(var l=0,d=a[1].length;d>l;l++)t+=s[a[1][l]](e,r);t+="</div>"}return o("note-air-popover",t)};return'<div class="note-popover">'+i()+a()+(r.airMode?l():"")+"</div>"},c=function(){return'<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-holder note-control-nw"></div><div class="note-control-holder note-control-ne"></div><div class="note-control-holder note-control-sw"></div><div class="note-control-sizing note-control-se"></div><div class="note-control-selection-info"></div></div></div>'},u=function(e,t){return'<table class="note-shortcut"><thead><tr><th></th><th>'+e+"</th></tr></thead><tbody>"+t+"</tbody></table>"},f=function(e){var t="<tr><td> + B</td><td>"+e.font.bold+"</td></tr><tr><td> + I</td><td>"+e.font.italic+"</td></tr><tr><td> + U</td><td>"+e.font.underline+"</td></tr><tr><td> +  + S</td><td>"+e.font.strikethrough+"</td></tr><tr><td> + \\</td><td>"+e.font.clear+"</td></tr>";return u(e.shortcut.textFormatting,t)},h=function(e){var t="<tr><td> + Z</td><td>"+e.history.undo+"</td></tr><tr><td> +  + Z</td><td>"+e.history.redo+"</td></tr><tr><td> + ]</td><td>"+e.paragraph.indent+"</td></tr><tr><td> + [</td><td>"+e.paragraph.outdent+"</td></tr><tr><td> + ENTER</td><td>"+e.hr.insert+"</td></tr>";return u(e.shortcut.action,t)},p=function(e){var t="<tr><td> +  + L</td><td>"+e.paragraph.left+"</td></tr><tr><td> +  + E</td><td>"+e.paragraph.center+"</td></tr><tr><td> +  + R</td><td>"+e.paragraph.right+"</td></tr><tr><td> +  + J</td><td>"+e.paragraph.justify+"</td></tr><tr><td> +  + NUM7</td><td>"+e.lists.ordered+"</td></tr><tr><td> +  + NUM8</td><td>"+e.lists.unordered+"</td></tr>";return u(e.shortcut.paragraphFormatting,t)},v=function(e){var t="<tr><td> + NUM0</td><td>"+e.style.normal+"</td></tr><tr><td> + NUM1</td><td>"+e.style.h1+"</td></tr><tr><td> + NUM2</td><td>"+e.style.h2+"</td></tr><tr><td> + NUM3</td><td>"+e.style.h3+"</td></tr><tr><td> + NUM4</td><td>"+e.style.h4+"</td></tr><tr><td> + NUM5</td><td>"+e.style.h5+"</td></tr><tr><td> + NUM6</td><td>"+e.style.h6+"</td></tr>";return u(e.shortcut.documentStyle,t)},g=function(e,t){var n=t.extraKeys,o="";for(var r in n)n.hasOwnProperty(r)&&(o+="<tr><td>"+r+"</td><td>"+n[r]+"</td></tr>");return u(e.shortcut.extraKeys,o)},m=function(e,t){var n='<table class="note-shortcut-layout"><tbody><tr><td>'+h(e,t)+"</td><td>"+f(e,t)+"</td></tr><tr><td>"+v(e,t)+"</td><td>"+p(e,t)+"</td></tr>";return t.extraKeys&&(n+='<tr><td colspan="2">'+g(e,t)+"</td></tr>"),n+="</tbody></table>"},b=function(e){return e.replace(//g,"Ctrl").replace(//g,"Shift")},y=function(e,t){var n=function(){var t='<div class="note-group-select-from-files"><h5>'+e.image.selectFromFiles+'</h5><input class="note-image-input" type="file" name="files" accept="image/*" /></div><h5>'+e.image.url+'</h5><input class="note-image-url form-control span12" type="text" />',n='<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+e.image.insert+"</button>";return a("note-image-dialog",e.image.insert,t,n)},o=function(){var n='<div class="form-group"><label>'+e.link.textToDisplay+'</label><input class="note-link-text form-control span12" type="text" /></div><div class="form-group"><label>'+e.link.url+'</label><input class="note-link-url form-control span12" type="text" /></div>'+(t.disableLinkTarget?"":'<div class="checkbox"><label><input type="checkbox" checked> '+e.link.openInNewWindow+"</label></div>"),o='<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+e.link.insert+"</button>";return a("note-link-dialog",e.link.insert,n,o)},i=function(){var t='<div class="form-group"><label>'+e.video.url+'</label>&nbsp;<small class="text-muted">'+e.video.providers+'</small><input class="note-video-url form-control span12" type="text" /></div>',n='<button href="#" class="btn btn-primary note-video-btn disabled" disabled>'+e.video.insert+"</button>";return a("note-video-dialog",e.video.insert,t,n)},s=function(){var n='<a class="modal-close pull-right" aria-hidden="true" tabindex="-1">'+e.shortcut.close+'</a><div class="title">'+e.shortcut.shortcuts+"</div>"+(r.isMac?m(e,t):b(m(e,t)))+'<p class="text-center"><a href="//hackerwins.github.io/summernote/" target="_blank">Summernote 0.5.9</a>  <a href="//github.com/HackerWins/summernote" target="_blank">Project</a>  <a href="//github.com/HackerWins/summernote/issues" target="_blank">Issues</a></p>';return a("note-help-dialog","",n,"")};return'<div class="note-dialog">'+n()+o()+i()+s()+"</div>"},C=function(){return'<div class="note-resizebar"><div class="note-icon-bar"></div><div class="note-icon-bar"></div><div class="note-icon-bar"></div></div>'},w=function(e){return r.isMac&&(e=e.replace("CMD","").replace("SHIFT","")),e.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]")},k=function(t,n,o){var r=i.invertObject(n),a=t.find("button");a.each(function(t,n){var o=e(n),i=r[o.data("event")];i&&o.attr("title",function(e,t){return t+" ("+w(i)+")"})}).tooltip({container:"body",trigger:"hover",placement:o||"top"}).on("click",function(){e(this).tooltip("hide")})},T=function(t,n){var o=n.colors;t.find(".note-color-palette").each(function(){for(var t=e(this),n=t.attr("data-target-event"),r=[],i=0,a=o.length;a>i;i++){for(var s=o[i],l=[],d=0,c=s.length;c>d;d++){var u=s[d];l.push(['<button type="button" class="note-color-btn" style="background-color:',u,';" data-event="',n,'" data-value="',u,'" title="',u,'" data-toggle="button" tabindex="-1"></button>'].join(""))}r.push('<div class="note-color-row">'+l.join("")+"</div>")}t.html(r.join(""))})};this.createLayoutByAirMode=function(t,n){var o=n.keyMap[r.isMac?"mac":"pc"],a=e.summernote.lang[n.lang],s=i.uniqueId();t.addClass("note-air-editor note-editable"),t.attr({id:"note-editor-"+s,contentEditable:!0});var d=document.body,u=e(l(a,n));u.addClass("note-air-layout"),u.attr("id","note-popover-"+s),u.appendTo(d),k(u,o),T(u,n);var f=e(c());f.addClass("note-air-layout"),f.attr("id","note-handle-"+s),f.appendTo(d);var h=e(y(a,n));h.addClass("note-air-layout"),h.attr("id","note-dialog-"+s),h.find("button.close, a.modal-close").click(function(){e(this).closest(".modal").modal("hide")}),h.appendTo(d)},this.createLayoutByFrame=function(t,n){var o=e('<div class="note-editor"></div>');n.width&&o.width(n.width),n.height>0&&e('<div class="note-statusbar">'+(n.disableResizeEditor?"":C())+"</div>").prependTo(o);var i=!t.is(":disabled"),a=e('<div class="note-editable" contentEditable="'+i+'"></div>').prependTo(o);n.height&&a.height(n.height),n.direction&&a.attr("dir",n.direction),a.html(d.html(t)||d.emptyPara),e('<textarea class="note-codable"></textarea>').prependTo(o);for(var u=e.summernote.lang[n.lang],f="",h=0,p=n.toolbar.length;p>h;h++){var v=n.toolbar[h][0],g=n.toolbar[h][1];f+='<div class="note-'+v+' btn-group">';for(var m=0,b=g.length;b>m;m++)e.isFunction(s[g[m]])&&(f+=s[g[m]](u,n));f+="</div>"}f='<div class="note-toolbar btn-toolbar">'+f+"</div>";var w=e(f).prependTo(o),x=n.keyMap[r.isMac?"mac":"pc"];T(w,n),k(w,x,"bottom");var N=e(l(u,n)).prependTo(o);T(N,n),k(N,x),e(c()).prependTo(o);var L=e(y(u,n)).prependTo(o);L.find("button.close, a.modal-close").click(function(){e(this).closest(".modal").modal("hide")}),e('<div class="note-dropzone"><div class="note-dropzone-message"></div></div>').prependTo(o),o.insertAfter(t),t.hide()},this.noteEditorFromHolder=function(t){return t.hasClass("note-air-editor")?t:t.next().hasClass("note-editor")?t.next():e()},this.createLayout=function(e,t){this.noteEditorFromHolder(e).length||(t.airMode?this.createLayoutByAirMode(e,t):this.createLayoutByFrame(e,t))},this.layoutInfoFromHolder=function(e){var t=this.noteEditorFromHolder(e);if(t.length){var n=d.buildLayoutInfo(t);for(var o in n)n.hasOwnProperty(o)&&(n[o]=n[o].call());return n}},this.removeLayout=function(e,t,n){n.airMode?(e.removeClass("note-air-editor note-editable").removeAttr("id contentEditable"),t.popover.remove(),t.handle.remove(),t.dialog.remove()):(e.html(t.editable.html()),t.editor.remove(),e.show())}};e.summernote=e.summernote||{},e.extend(e.summernote,c);var S=new L,F=new N;e.fn.extend({summernote:function(t){if(t=e.extend({},e.summernote.options,t),this.each(function(n,o){var r=e(o);S.createLayout(r,t);var i=S.layoutInfoFromHolder(r);F.attach(i,t),d.isTextarea(r[0])&&r.closest("form").submit(function(){r.val(r.code())})}),this.first().length&&t.focus){var n=S.layoutInfoFromHolder(this.first());n.editable.focus()}return this.length&&t.oninit&&t.oninit(),this},code:function(t){if(void 0===t){var n=this.first();if(!n.length)return;var o=S.layoutInfoFromHolder(n);if(o&&o.editable){var i=o.editor.hasClass("codeview");return i&&r.hasCodeMirror&&o.codable.data("cmEditor").save(),i?o.codable.val():o.editable.html()}return d.isTextarea(n[0])?n.val():n.html()}return this.each(function(n,o){var r=S.layoutInfoFromHolder(e(o));r&&r.editable&&r.editable.html(t)}),this},destroy:function(){return this.each(function(t,n){var o=e(n),r=S.layoutInfoFromHolder(o);if(r&&r.editable){var i=r.editor.data("options");F.dettach(r,i),S.removeLayout(o,r,i)}}),this}})});
var adminController=function(e,t,o,l){var n,a,d,g,r,i,u,s,c;return n=apiServices(),s=messagingController(),r={ready:!1},i={bound:!1,tracking:[]},c={},d={saveBlog:"#saveBlogBtn",deleteBlog:"#deleteBlogBtn",debug:!0},i.saveBlog=function(e){e&&e.preventDefault();var l,n,a;return l=o(this),n=l.data(),n.formSelector&&(a=o(n.formSelector).serializeObject(),a.title.length&&a.body.length?(l.addClass("disabled"),c.saveBlog(a,function(e,o){e&&s.toggle({text:"Validation Error: "+JSON.stringify(e),delay:2e3,func:function(){l.removeClass("disabled")}}),o&&s.toggle({text:"Redirecting you to blog post",delay:2e3,func:function(){t.location.href="/blog/"+o._id}})})):s.toggle({text:"You must provide at least a title and content for your post",delay:2e3})),!1},i.deleteBlog=function(e){e&&e.preventDefault();var t,l;t=o(this),l=t.data(),l.id&&c.deleteBlog(l.id,function(e,t){return e?console.log(e):void 0})},c.saveBlog=function(e,t){return n.post("blogs",e,t)},c.deleteBlog=function(e,t){return n.delete("blogs",{id:e},t)},a=function(){i.bound||(i.bound=!0,r[d.saveBlog].length&&(r[d.saveBlog].on("click",i.saveBlog),i.tracking.push(d.saveBlog)),r[d.deleteBlog].length&&(r[d.deleteBlog].on("click",i.deleteBlog),i.tracking.push(d.deleteBlog)))},g=function(){l.events=i,l.dom=r,l.conf=d},u=function(){r.ready||(r.ready=!0,r[d.saveBlog]=o(d.saveBlog),r[d.deleteBlog]=o(d.deleteBlog),a())},o(t).ready(u),function(e){return e&&o.extend(d,e),d.debug&&g(),l}}(window,document,jQuery,{});